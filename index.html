<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Calculs VL / DAB / Prix ‚Äì Espace</title>

<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">

<style>
  :root{--bg:#0f172a;--card:#111827;--ink:#e5e7eb;--muted:#9ca3af;--accent:#22d3ee;--border:#1f2937;--input:#0b1220;--btn:#0b1220;--btnbd:#1f2937;}
  [data-theme="light"]{--bg:#f8fafc;--card:#ffffff;--ink:#0f172a;--muted:#475569;--accent:#06b6d4;--border:#e2e8f0;--input:#ffffff;--btn:#ffffff;--btnbd:#cbd5e1;}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;background:var(--bg);color:var(--ink)}
  .wrap{max-width:1080px;margin:0 auto;padding:18px}
  h1{font-size:1.4rem;margin:6px 0 8px}
  .sub{color:var(--muted);font-size:.9rem;margin-bottom:16px}
  .nav{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:8px 0 16px}
  .nav .right{margin-left:auto}
  .grid{display:grid;gap:14px}
  @media(min-width:980px){.grid{grid-template-columns:1fr 1fr}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.08)}
  .card h2{font-size:1.05rem;margin:0 0 10px;color:var(--accent)}
  label{display:block;font-size:.9rem;margin:10px 0 4px;color:var(--muted)}
  input{width:100%;padding:10px;border:1px solid var(--border);border-radius:12px;background:var(--input);color:var(--ink)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .hint{font-size:.8rem;color:var(--muted)}
  .out{font-variant-numeric:tabular-nums}
  .home-grid{display:grid;gap:14px;grid-template-columns:1fr}
  @media(min-width:860px){.home-grid{grid-template-columns:1fr 1fr 1fr}}
  .home-card{cursor:pointer;text-align:center;padding:24px}
  .home-card h3{margin:0 0 8px}
  .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:8px}
  .btn{padding:9px 12px;border-radius:12px;border:1px solid var(--btnbd);background:var(--btn);color:var(--ink);cursor:pointer}
  footer{margin-top:18px;color:var(--muted);font-size:.8rem}
  hr{border:0;border-top:1px solid var(--border);margin:14px 0}
  @media print{
    body{background:#fff !important;color:#000 !important;}
    .nav, .home-grid, footer, .toolbar{display:none !important;}
    .card{box-shadow:none !important;border:0 !important;}
    .card:not(.to-print){display:none !important;}
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div class="wrap">
  <div class="nav">
    <h1 style="margin:0">Espace calculs ‚Äì VL / DAB / Prix</h1>
    <span class="sub">Choisis un module ou reste sur l'accueil</span>
    <button id="toggleTheme" class="btn right">üåì Th√®me</button>
  </div>

  <!-- Accueil -->
  <section id="home">
    <div class="home-grid">
      <div class="card home-card" onclick="show('vl')"><h3>üè∑Ô∏è Valeur locative</h3><div class="hint">Surface simple ou pond√©r√©e</div></div>
      <div class="card home-card" onclick="show('dab')"><h3>üìú Droit au bail</h3><div class="hint">√âconomies actualis√©es</div></div>
      <div class="card home-card" onclick="show('prix')"><h3>üí∂ Prix √† partir du loyer</h3><div class="hint">Prix = Loyer annuel / Rendement</div></div>
    </div>
  </section>

  <!-- Valeur locative -->
  <section id="vl" style="display:none">
    <div class="card" id="vlCard">
      <h2>Valeur locative (formule mixte)</h2>
      <div class="row">
        <div><label>Loyer constat√© (‚Ç¨/an)</label><input type="number" id="loyerConst" value="18000"></div>
        <div><label>Prix de cession (‚Ç¨)</label><input type="number" id="prixCession" value="300000"></div>
      </div>
      <div class="row">
        <div><label>Taux de rendement esp√©r√© (%)</label><input type="number" id="tauxRdt" value="6"></div>
        <div><label><input type="checkbox" id="usePonderee" onchange="toggleSurface()"> Utiliser une surface pond√©r√©e</label></div>
      </div>
      <div id="surfaceSimple">
        <label>Surface totale (m¬≤)</label>
        <input type="number" id="surface" value="100">
      </div>
      <div id="surfacePonderee" style="display:none">
        <div class="row">
          <div><label>Surface de vente (100%)</label><input type="number" id="surfVente" value="80"></div>
          <div><label>R√©serve (50%)</label><input type="number" id="surfReserve" value="20"></div>
        </div>
        <label>Annexes (33%)</label>
        <input type="number" id="surfAnnexes" value="10">
      </div>
      <hr>
      <div class="out" id="outVL"></div>
      <div class="toolbar">
        <button class="btn" onclick="exportPDF('vlCard','vl_calcul.pdf')">üìÑ Exporter en PDF</button>
        <button class="btn" onclick="printCard('vlCard')">üñ®Ô∏è Imprimer PDF</button>
        <button class="btn" onclick="show('home')">‚¨ÖÔ∏è Accueil</button>
      </div>
    </div>
  </section>

  <!-- DAB -->
  <section id="dab" style="display:none">
    <div class="card" id="dabCard">
      <h2>Droit au bail</h2>
      <div class="row">
        <div><label>VL de march√© (‚Ç¨/an)</label><input type="number" id="vlMarche" value="36000"></div>
        <div><label>Loyer bail (‚Ç¨/an)</label><input type="number" id="loyerBail" value="24000"></div>
      </div>
      <div class="row">
        <div><label>Taux actualisation (%)</label><input type="number" id="tauxActu" value="6"></div>
        <div><label>Dur√©e (ann√©es)</label><input type="number" id="duree" value="6"></div>
      </div>
      <hr>
      <div class="out" id="outDAB"></div>
      <div class="hint" id="noteDAB"></div>
      <div class="toolbar">
        <button class="btn" onclick="exportPDF('dabCard','dab_calcul.pdf')">üìÑ Exporter PDF</button>
        <button class="btn" onclick="printCard('dabCard')">üñ®Ô∏è Imprimer PDF</button>
        <button class="btn" onclick="show('home')">‚¨ÖÔ∏è Accueil</button>
      </div>
    </div>
  </section>

  <!-- Prix -->
  <section id="prix" style="display:none">
    <div class="card" id="prixCard">
      <h2>Prix de vente cible</h2>
      <div class="row">
        <div><label>Loyer annuel (‚Ç¨/an)</label><input type="number" id="loyerAnnuelPrix" value="36000"></div>
        <div><label>Rendement (%)</label><input type="number" id="rdtPrix" value="6" step="0.1"></div>
      </div>
      <div style="margin-top:10px">
        <label>Varier le rendement (%)</label>
        <input type="range" id="rdtSlider" min="3" max="12" step="0.1" value="6" oninput="syncRdt(this.value)">
      </div>
      <hr>
      <div class="out" id="outPrix"></div>
      <div id="tablePrix"></div>
      <div class="toolbar">
        <button class="btn" onclick="exportPDF('prixCard','prix_calcul.pdf')">üìÑ Exporter PDF</button>
        <button class="btn" onclick="printCard('prixCard')">üñ®Ô∏è Imprimer PDF</button>
        <button class="btn" onclick="show('home')">‚¨ÖÔ∏è Accueil</button>
      </div>
    </div>
  </section>

  <footer>‚ö†Ô∏è R√©sultats indicatifs.</footer>
</div>

<script>
const $=id=>document.getElementById(id);
function show(sec){['home','vl','dab','prix'].forEach(id=>$(id).style.display='none');$(sec).style.display='block';}

// Surface pond√©r√©e
function toggleSurface(){
  if($('usePonderee').checked){
    $('surfaceSimple').style.display='none';
    $('surfacePonderee').style.display='block';
  } else {
    $('surfaceSimple').style.display='block';
    $('surfacePonderee').style.display='none';
  }
  calcVL();
}

// VL
function calcVL(){
  const l=+$('loyerConst').value, p=+$('prixCession').value, t=(+$('tauxRdt').value)/100;
  let surf;
  if($('usePonderee').checked){
    surf = +$('surfVente').value + (+$('surfReserve').value*0.5) + (+$('surfAnnexes').value*0.33);
  } else {
    surf = +$('surface').value;
  }
  const vl_m2 = surf>0?(l+p*t)/surf:0;
  const ann = vl_m2*surf, mens = ann/12;
  $('outVL').innerHTML=`<strong>VL ‚âà ${vl_m2.toFixed(2)} ‚Ç¨/m¬≤/an</strong><br>Loyer annuel ‚âà ${ann.toFixed(0)} ‚Ç¨<br>Loyer mensuel ‚âà ${mens.toFixed(0)} ‚Ç¨`;
}
['loyerConst','prixCession','tauxRdt','surface','surfVente','surfReserve','surfAnnexes'].forEach(id=>document.addEventListener('input',e=>{if(e.target.id===id)calcVL();}));

// DAB
function calcDAB(){
  const vl=+$('vlMarche').value, lb=+$('loyerBail').value, r=(+$('tauxActu').value)/100, nAn=+$('duree').value;
  const eco=vl-lb;let dab=0,msg='';
  if(r>0&&nAn>0){dab=(eco/r)*(1-1/Math.pow(1+r,nAn));if(eco<=0)msg="‚ö†Ô∏è √âconomie ‚â§ 0";}
  $('outDAB').innerHTML=`√âconomie annuelle : ${eco.toFixed(0)} ‚Ç¨<br><strong>DAB ‚âà ${dab.toFixed(0)} ‚Ç¨</strong>`;
  $('noteDAB').textContent=msg;
}
['vlMarche','loyerBail','tauxActu','duree'].forEach(id=>document.addEventListener('input',e=>{if(e.target.id===id)calcDAB();}));

// Prix
function syncRdt(v){$('rdtPrix').value=v;calcPrix();}
['loyerAnnuelPrix','rdtPrix'].forEach(id=>document.addEventListener('input',e=>{if(e.target.id==='rdtPrix')$('rdtSlider').value=e.target.value;calcPrix();}));
function calcPrix(){
  const L=+$('loyerAnnuelPrix').value,r=(+$('rdtPrix').value)/100;const prix=r>0?L/r:0;
  $('outPrix').innerHTML=`Rendement : ${r*100}%<br><strong>Prix ‚âà ${prix.toFixed(0)} ‚Ç¨</strong>`;
}

// Export PDF
async function exportPDF(cardId,filename){
  const node=$(cardId);const canvas=await html2canvas(node,{scale:2,background:'#fff'});
  const img=canvas.toDataURL('image/jpeg',0.95);const {jsPDF}=window.jspdf;
  const doc=new jsPDF({orientation:'p',unit:'pt',format:'a4'});
  const pageW=doc.internal.pageSize.getWidth(),pageH=doc.internal.pageSize.getHeight();
  const m=36,availW=pageW-m*2,availH=pageH-m*2;
  const ratio=Math.min(availW/canvas.width,availH/canvas.height);
  doc.addImage(img,'JPEG',m,m,canvas.width*ratio,canvas.height*ratio);
  try{doc.save(filename);}catch(e){const blob=doc.output('blob');const url=URL.createObjectURL(blob);window.open(url,'_blank');setTimeout(()=>URL.revokeObjectURL(url),60000);}
}
function printCard(cardId){const node=$(cardId);node.classList.add('to-print');window.print();setTimeout(()=>node.classList.remove('to-print'),1000);}

// Init
calcVL();calcDAB();calcPrix();show('home');
</script>
</body>
</html>


