<!doctype html>
<html lang="fr">
<head>
  <link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Calculs VL / DAB / Prix ‚Äì Espace</title>
<style>
  :root{
    --bg:#0f172a;--card:#111827;--ink:#e5e7eb;--muted:#9ca3af;--accent:#22d3ee;--border:#1f2937;--input:#0b1220;
    --btn:#0b1220;--btnbd:#1f2937;
  }
  [data-theme="light"]{
    --bg:#f8fafc;--card:#ffffff;--ink:#0f172a;--muted:#475569;--accent:#06b6d4;--border:#e2e8f0;--input:#ffffff;
    --btn:#ffffff;--btnbd:#cbd5e1;
  }
  *{box-sizing:border-box}
  <script>
async function exportPDF(sectionId){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({orientation: "portrait", unit: "pt", format: "a4"});
  let section = document.getElementById(sectionId);
  let text = section.innerText;

  // D√©coupe en lignes automatiques
  const lines = doc.splitTextToSize(text, 500);

  doc.setFont("helvetica","normal");
  doc.setFontSize(12);
  doc.text(lines, 50, 60);

  // Sauvegarde
  doc.save(sectionId + "_calcul.pdf");
}
</script>

  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;background:var(--bg);color:var(--ink)}
  .wrap{max-width:1080px;margin:0 auto;padding:18px}
  h1{font-size:1.4rem;margin:6px 0 8px}
  .sub{color:var(--muted);font-size:.9rem;margin-bottom:16px}
  .nav{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:8px 0 16px}
  .nav button{padding:9px 12px;border-radius:12px;border:1px solid var(--btnbd);background:var(--btn);color:var(--ink);cursor:pointer}
  .nav .right{margin-left:auto}
  .grid{display:grid;gap:14px}
  @media(min-width:980px){.grid{grid-template-columns:1fr 1fr}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.08)}
  .card h2{font-size:1.05rem;margin:0 0 10px;color:var(--accent)}
  label{display:block;font-size:.9rem;margin:10px 0 4px;color:var(--muted)}
  input,select{width:100%;padding:10px;border:1px solid var(--border);border-radius:12px;background:var(--input);color:var(--ink)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .hint{font-size:.8rem;color:var(--muted)}
  .out{font-variant-numeric:tabular-nums}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:var(--btn);border:1px solid var(--btnbd);color:var(--muted);font-size:.8rem}
  details{margin-top:6px}
  .warn{color:#e11d48}
  footer{margin-top:18px;color:var(--muted);font-size:.8rem}
  .home-grid{display:grid;gap:14px;grid-template-columns:1fr;}
  @media(min-width:860px){.home-grid{grid-template-columns:1fr 1fr 1fr}}
  .home-card{cursor:pointer;text-align:center;padding:24px}
  .home-card h3{margin:0 0 8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="nav">
    <h1 style="margin:0">Espace calculs ‚Äì VL / DAB / Prix</h1>
    <span class="sub">Choisis un module ou reste sur l'accueil</span>
    <button id="toggleTheme" class="right" title="Basculer clair/sombre">üåì Th√®me</button>
  </div>

  <!-- Accueil -->
  <section id="home">
    <div class="home-grid">
      <div class="card home-card" onclick="show('vl')">
        <h3>üè∑Ô∏è Valeur locative</h3>
        <div class="hint">Formule mixte : (loyer + prix√ótaux)/surface</div>
      </div>
      <div class="card home-card" onclick="show('dab')">
        <h3>üìú Droit au bail</h3>
        <div class="hint">√âconomies actualis√©es sur dur√©e certaine</div>
      </div>
      <div class="card home-card" onclick="show('prix')">
        <h3>üí∂ Prix √† partir du loyer</h3>
        <div class="hint">Prix = Loyer annuel / Rendement</div>
      </div>
    </div>
  </section>

  <!-- Module VL -->
  <section id="vl" style="display:none">
    <div class="card">
      <h2>Valeur locative (formule mixte)</h2>
      <div class="row">
        <div>
          <label>Loyer constat√© (‚Ç¨/an)</label>
          <input type="number" id="loyerConst" min="0" step="0.01" value="18000">
        </div>
        <div>
          <label>Prix de cession (‚Ç¨)</label>
          <input type="number" id="prixCession" min="0" step="0.01" value="300000">
        </div>
      </div>
      <div class="row">
        <div>
          <label>Taux de rendement esp√©r√© (%)</label>
          <input type="number" id="tauxRdt" min="0" step="0.01" value="6">
        </div>
        <div>
          <label>Surface de r√©f√©rence (m¬≤)</label>
          <input type="number" id="surface" min="0.01" step="0.01" value="100">
        </div>
      </div>
      <hr>
      <div class="out" id="outVL"></div>
    </div>
    <button onclick="exportPDF('vl')">üìÑ Exporter en PDF</button>

  </section>

  <!-- Module DAB -->
  <section id="dab" style="display:none">
    <div class="card">
      <h2>Droit au bail (√©conomies actualis√©es)</h2>
      <div class="row">
        <div>
          <label>Valeur locative de march√© (‚Ç¨/an)</label>
          <input type="number" id="vlMarche" min="0" step="0.01" value="36000">
        </div>
        <div>
          <label>Loyer pay√© au bail (‚Ç¨/an)</label>
          <input type="number" id="loyerBail" min="0" step="0.01" value="24000">
        </div>
      </div>
      <div class="row">
        <div>
          <label>Taux d‚Äôactualisation (%)</label>
          <input type="number" id="tauxActu" min="0.01" step="0.01" value="6">
        </div>
        <div>
          <label>Dur√©e certaine (ann√©es)</label>
          <input type="number" id="duree" min="0.25" step="0.25" value="6">
        </div>
      </div>
      <hr>
      <div class="out" id="outDAB"></div>
      <div class="hint warn" id="noteDAB"></div>
    </div>
    <button onclick="exportPDF('vl')">üìÑ Exporter en PDF</button>

  </section>

  <!-- Module Prix -->
  <section id="prix" style="display:none">
    <div class="card">
      <h2>Prix de vente cible (√† partir du loyer annuel)</h2>
      <div class="row">
        <div>
          <label>Loyer annuel (‚Ç¨/an)</label>
          <input type="number" id="loyerAnnuelPrix" min="0" step="0.01" value="36000">
        </div>
        <div>
          <label>Rendement esp√©r√© (%)</label>
          <input type="number" id="rdtPrix" min="0.1" step="0.1" value="6">
        </div>
      </div>
      <div style="margin-top:10px">
        <label>Varier le rendement (%)</label>
        <input type="range" id="rdtSlider" min="3" max="12" step="0.1" value="6" oninput="syncRdt(this.value)">
      </div>
      <hr>
      <div class="out" id="outPrix"></div>
      <div id="tablePrix"></div>
    </div>
    <button onclick="exportPDF('vl')">üìÑ Exporter en PDF</button>

  </section>

  <footer>
    ‚ö†Ô∏è R√©sultats indicatifs. Confronter au bail, au march√© et √† la r√©glementation.
  </footer>
</div>

<script>
const $ = (id)=>document.getElementById(id);

(function initTheme(){
  const stored = localStorage.getItem('theme');
  if(stored){ document.documentElement.setAttribute('data-theme', stored); }
  $('toggleTheme').addEventListener('click', ()=>{
    const cur = document.documentElement.getAttribute('data-theme')==='light' ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', cur);
    localStorage.setItem('theme', cur);
  });
})();

function show(section){
  ['home','vl','dab','prix'].forEach(id=>$(id).style.display='none');
  $(section).style.display='block';
  window.scrollTo({top:0,behavior:'smooth'});
}

function n(v){ return isFinite(v) ? v : 0; }
function fmtEUR(x){ return (isFinite(x)? x:0).toLocaleString('fr-FR',{style:'currency',currency:'EUR',maximumFractionDigits:0}); }
function fmtNb(x){ return (isFinite(x)? x:0).toLocaleString('fr-FR',{maximumFractionDigits:2}); }

// VL
function calcVL(){
  const loyerConst = parseFloat($('loyerConst').value);
  const prix = parseFloat($('prixCession').value);
  const tauxRdtPct = parseFloat($('tauxRdt').value);
  const surf = parseFloat($('surface').value);
  const rdt = n(tauxRdtPct)/100;
  const vl_m2 = surf>0 ? (n(loyerConst) + n(prix)*rdt) / surf : 0;
  const loyerAnnuel = vl_m2 * surf;
  const loyerMensuel = loyerAnnuel/12;
  $('outVL').innerHTML = `<div>
    <div><strong>VL ‚âà ${fmtNb(vl_m2)} ‚Ç¨/m¬≤/an</strong></div>
    <div>Loyer cible annuel ‚âà ${fmtEUR(loyerAnnuel)}</div>
    <div>Loyer cible mensuel ‚âà ${fmtEUR(loyerMensuel)}</div>
  </div>`;
}
['loyerConst','prixCession','tauxRdt','surface'].forEach(id=>document.addEventListener('input', e=>{ if(e.target.id===id) calcVL(); }));

// DAB
function calcDAB(){
  const vlMarche = parseFloat($('vlMarche').value);
  const loyerBail = parseFloat($('loyerBail').value);
  const tauxActuPct = parseFloat($('tauxActu').value);
  const nAn = parseFloat($('duree').value);
  const eco = n(vlMarche) - n(loyerBail);
  const r = n(tauxActuPct)/100;
  let dab = 0, msg = "";
  if (r<=0 || nAn<=0){ msg = "Taux et dur√©e doivent √™tre > 0."; }
  else {
    const facteur = 1 - 1/Math.pow(1+r, nAn);
    dab = (eco / r) * facteur;
    if (eco<=0){ msg = "‚ö†Ô∏è √âconomie ‚â§ 0 : DAB nul ou n√©gatif."; }
  }
  $('outDAB').innerHTML = `<div>
    <div>√âconomie annuelle : ${fmtEUR(eco)}</div>
    <div><strong>Droit au bail ‚âà ${fmtEUR(dab)}</strong></div>
  </div>`;
  $('noteDAB').textContent = msg;
}
['vlMarche','loyerBail','tauxActu','duree'].forEach(id=>document.addEventListener('input', e=>{ if(e.target.id===id) calcDAB(); }));

// Prix
function syncRdt(val){ $('rdtPrix').value = val; calcPrix(); }
['loyerAnnuelPrix','rdtPrix'].forEach(id=>document.addEventListener('input', e=>{ if(e.target.id===id){ if(id==='rdtPrix') $('rdtSlider').value=e.target.value; calcPrix(); }}));

function calcPrix(){
  const loyer = parseFloat($('loyerAnnuelPrix').value);
  const rdtPct = parseFloat($('rdtPrix').value);
  const r = n(rdtPct)/100;
  const prix = r>0 ? n(loyer)/r : 0;
  $('outPrix').innerHTML = `<div>
    Rendement : ${fmtNb(rdtPct)} %<br>
    <strong>Prix cible ‚âà ${fmtEUR(prix)}</strong>
  </div>`;
  renderTablePrix();
}
function renderTablePrix(){
  const loyer = parseFloat($('loyerAnnuelPrix').value);
  let html = '<table><thead><tr><th>Rendement</th><th>Prix estim√©</th></tr></thead><tbody>';
  for(let r=3; r<=12.01; r+=0.5){
    const prix = (n(loyer))/ (r/100);
    html += `<tr><td>${r.toFixed(1)} %</td><td>${fmtEUR(prix)}</td></tr>`;
  }
  html += '</tbody></table>';
  $('tablePrix').innerHTML = html;
}

// init
calcVL(); calcDAB(); calcPrix(); show('home');
</script>
</body>
</html>
